---
title: "College Outcomes Analysis"
author: "Richard Decal"
date: "October 26, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Step 0: Read libraries  
```{r}
library(dplyr)
library(purrr)
library(data.table)
```

Step 1: Set working directory  
```{r}
# double check that this puts you in the right dir
project.dir <- getwd()
setwd(project.dir)
dataset.dir <- "Data"
outputs.dir <- "Output"
```


Step 2: Generate a list of files to be read in  
```{r}
file_names <- list.files(file.path(project.dir, dataset.dir), pattern="*.csv", full.names=TRUE) 
my.subset <- file_names[19:20]
my.subset
```


Step 3: Create function for reading in filename string
split on the underscore (_)
For example:
create array from filename "ACS_16_1YR_S0801"
which looks like c("ACS", "16", "1YR", "S0801")
we can pull out the year 16 from the array  
```{r}
extract_yr_from_fname <- function(fname) {
  l <- nchar(fname)
  print(l)
  start <- l-13
  end <- l-10
  year <- substr(fname, start, end)
  return(year)
}
lapply(my.subset, extract_yr_from_fname)
```



Step 4: Read in files and combine    

The file reads in missing data as "NA", so we will coerce those entries into NA's.  

```{r}
read_my_files <- function(filename){
    x <- fread(filename, skip=0, na.strings = c("NULL"))
    
    # obtain the path, which has the year in filename
    # append col called filename to x
      x <- mutate(x, Filename=extract_yr_from_fname(filename))
      return(x)
}

# sends filenames to file reader func
combined <- map_df(my.subset, read_my_files)
#lapply(my.subset, read_my_files)
#View(combined)
```


Step 4: Clean data & only keep variables of interest 

obtain the year from the name of the csv file and save it into a variable called year  

## YOU CAN FILTER WHATEVER YOU WANT OUT OF THE DATA FRAME BY PUTTING
YOUR PARAMTERS INTO SELECT   

select(starts_with"blah blah text of innerest")

like say I wanted to select the column variable named institutiotion 
I would put the select function 
select(INSTNM)
```{r}
# cleaning the combined tables
#processed_frame <- combined %>%
 # mutate(year = map_chr(Filename, extract_yr_from_fname, 2)) #%>% 
  
  # add your filtering / desired columns
 # select(starts_with("INSTNM"))
  #select(-starts_with("HC02")) %>% 
  #select(-starts_with("HC03"))
#View(processed_frame)
select(processed_frame, starts_with("year"))
```


Step 7: Write the desired dataframe into csv  
```{r}
write_csv(processed_frame, "processed_college_outcomes.csv")
```


