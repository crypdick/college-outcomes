---
title: "College Outcomes Analysis"
author: "Richard Decal"
date: "October 26, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Step 0: Read libraries  
```{r}
library(tidyverse)
library(purrr)
library(data.table)
```

Step 1: Set working directory  
```{r}
project.dir <- "/Users/fanny/Google Drive/munge/college-outcomes"
setwd(project.dir)
dataset.dir <- "Datasets"
outputs.dir <- "Output"
```


Step 2: Generate a list of files to be read in  
```{r}
file_names <- list.files(file.path(project.dir, dataset.dir), pattern="*.csv", full.names=TRUE) 
my.subset <- file_names[1:2]
my.subset
```


Step 3: Create function for reading in filename string
split on the underscore (_)  
For example:
create array from filename "ACS_16_1YR_S0801"
which looks like c("ACS", "16", "1YR", "S0801")
we can pull out the year 16 from the array  
```{r}
strsplit_that_works <- function(cell, entity_requested) {
  x <- strsplit(cell, "_")
  y <- x[[1]][entity_requested]
  return(y)
}
```



Step 4: Read in files and combine    

The file reads in missing data as "NA", so we will coerce those entries into NA's.  

```{r}
read_my_files <- function(filename){
    x <- fread(filename, skip=0, na.strings = c("NULL"))
    
    # obtain the path, which has the year in filename
      x <- mutate(x, Filename=sub(project.dir, "", filename))
      return(x)
}

combined <- map_df(my.subset, read_my_files)
View(combined)
```


Step 4: Clean data & only keep variables of interest  
```{r}
processed_frame <- combined %>%
  mutate(year = map_chr(Filename, strsplit_that_works, 2)) %>% 
  select(-starts_with("HC02")) %>% 
  select(-starts_with("HC03"))
#View(processed_frame)
```


Step 7: Write the desired dataframe into csv  
```{r}
write_csv(processed_frame, "processed_college_outcomes.csv")
```


